<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact Developers - AttendAce</title>
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background: #fff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      max-width: 500px;
      width: 100%;
    }

    h2 {
      color: #2d6a4f;
      margin-bottom: 20px;
      text-align: center;
    }

    textarea {
      width: 100%;
      min-height: 150px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
      font-size: 14px;
    }

    button {
      background: #2d6a4f;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 15px;
      width: 100%;
      transition: background 0.3s;
    }

    button:hover {
      background: #1b4332;
    }

    .message {
      margin-top: 15px;
      font-size: 14px;
      color: #1b4332;
      text-align: center;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>Contact Developers</h2>

<!-- ⭐ Star rating -->
<div id="starRating" style="text-align:center; margin-bottom:15px;">
  <span data-star="1" style="font-size:30px; cursor:pointer;">☆</span>
  <span data-star="2" style="font-size:30px; cursor:pointer;">☆</span>
  <span data-star="3" style="font-size:30px; cursor:pointer;">☆</span>
  <span data-star="4" style="font-size:30px; cursor:pointer;">☆</span>
  <span data-star="5" style="font-size:30px; cursor:pointer;">☆</span>
</div>

<textarea id="feedbackMessage" placeholder="Optional: Type your message here (max 500 characters)..."></textarea>
<button id="sendBtn">Send Feedback</button>
<div class="message" id="statusMessage"></div>
  </div>

  <script>
    const token = localStorage.getItem('token');
    const user = JSON.parse(localStorage.getItem('user'));

    // Redirect to login if not logged in
    if (!token || !user) {
      window.location.href = 'login.html';
    }

    const sendBtn = document.getElementById('sendBtn');
    const feedbackMessage = document.getElementById('feedbackMessage');
    const statusMessage = document.getElementById('statusMessage');

let selectedRating = 0;
const stars = document.querySelectorAll('#starRating span');

stars.forEach(star => {
  star.addEventListener('click', () => {
    selectedRating = star.dataset.star;
    stars.forEach(s => {
      s.textContent = s.dataset.star <= selectedRating ? '⭐' : '☆';
    });
  });
});

sendBtn.addEventListener('click', async () => {
  const message = feedbackMessage.value.trim();

  if (!selectedRating) {
    statusMessage.textContent = 'Please select a star rating.';
    return;
  }

  if (message.length > 500) {
    statusMessage.textContent = 'Message too long. Max 500 characters allowed.';
    return;
  }

  sendBtn.disabled = true;
  statusMessage.textContent = 'Sending...';

  try {
    const response = await fetch('/api/contact/contact-developers', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        userId: user.id,
        rating: selectedRating,
        message
      })
    });

    const data = await response.json();
    statusMessage.textContent = response.ok ? data.message : (data.message || 'Error sending feedback.');
    if (response.ok) feedbackMessage.value = '';
  } catch (err) {
    console.error(err);
    statusMessage.textContent = 'Server error. Please try again later.';
  } finally {
    sendBtn.disabled = false;
  }
});

  
  </script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AttendAce – Gamified Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles2.css">

</head>

<body class="font-sans max-w-[420px] mx-auto overflow-y-auto relative z-10"><!-- ANIMATED GAMING BACKGROUND -->
<div id="bg-anim"></div>
<!-- CLICK SOUND -->
<audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3"></audio>

<!-- HEADER -->
<header class="p-4 flex justify-between items-center reveal">
  <h1 class="font-black text-lg tracking-tight">AttendAce</h1>
  <button id="themeToggle" class="px-4 py-2 rounded-full glass text-xs font-bold press">
    OFFICIAL
  </button>
</header>

<!-- DASHBOARD CARD -->
<section class="px-5 mt-4 reveal">
  <div class="glass p-6 relative overflow-hidden flex justify-between items-center">
  <div class="flex-1">
    <p class="text-xs font-semibold text-[var(--accent)] relative" id="studentId">ID: --</p>
    <h2 class="text-3xl font-black mt-1 relative" id="studentName">Student Name</h2>
    <p class="text-sm text-[var(--muted)] relative" id="studentDept">Department: --</p>
  </div>
  <!-- Logout Icon Button -->
  <button id="logoutBtn" class="ml-4 p-2 rounded-full glass press">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1" />
    </svg>
  </button>
</div>
</section>

<section class="px-6 mt-6 flex flex-col gap-3 reveal pb-6">
  <!-- HERO BUTTON – MARK ATTENDANCE -->
  <button class="hero-btn press w-full h-[120px] rounded-2xl
               flex flex-col justify-center items-center
               font-black text-white text-2xl relative
               bg-gradient-to-r from-green-600 to-green-500
               shadow-lg hover:shadow-xl transition-all duration-300"
          onclick="window.location.href='scanface.html'">
    <span class="text-xs opacity-80 tracking-widest">TAP TO</span>
    MARK ATTENDANCE
  </button>

  <!-- MENU BUTTONS LINKED -->
   <button class="menu-btn group w-full rounded-xl p-4 flex flex-col items-start"
        onclick="window.location.href='scanqr.html'">

  <!-- Main row: Icon + Button name -->
  <div class="flex items-center gap-3">
    <img src="assets/scan-qr.svg" alt="QR Scan" class="w-6 h-6">
    <div class="text-lg font-semibold">QR Attendance Scan</div>
  </div>

  <!-- Hover text below -->
  <div class="text-xs text-gray-500 mt-2 max-h-0 opacity-0 transition-all duration-300 group-hover:max-h-20 group-hover:opacity-100">
    Scan a valid QR code to securely mark your attendance.
  </div>

</button>

  <button class="menu-btn group w-full h-[75px] rounded-xl" onclick="window.location.href='analytics-student.html'">
    <div class="text-lg">Attendance Analytics</div>
    <div class="text-xs text-gray-500 mt-1 max-h-0 opacity-0 transition-all duration-300 group-hover:max-h-6 group-hover:opacity-100">
      View detailed insights and statistics of your attendance records.
    </div>
  </button>

  <button class="menu-btn group w-full h-[75px] rounded-xl" onclick="window.location.href='student-classes.html'">
    <div class="text-lg">Class Management</div>
    <div class="text-xs text-gray-500 mt-1 max-h-0 opacity-0 transition-all duration-300 group-hover:max-h-6 group-hover:opacity-100">
      View and manage your enrolled classes efficiently.
    </div>
  </button>

  <button class="menu-btn group w-full h-[75px] rounded-xl" onclick="window.location.href='settings.html'">
    <div class="text-lg">Account Settings</div>
    <div class="text-xs text-gray-500 mt-1 max-h-0 opacity-0 transition-all duration-300 group-hover:max-h-6 group-hover:opacity-100">
      Manage your preferences, security, and account details.
    </div>
  </button>


  <button class="menu-btn group w-full h-[75px] rounded-xl" onclick="window.location.href='register-face.html'">
    <div class="text-lg">Face Data Update</div>
    <div class="text-xs text-gray-500 mt-1 max-h-0 opacity-0 transition-all duration-300 group-hover:max-h-6 group-hover:opacity-100">
      Register or update your facial data for verification.
    </div>
  </button>

  <button class="menu-btn group w-full h-[75px] rounded-xl" onclick="window.location.href='contact-developers.html'">
    <div class="text-lg">Developer Support</div>
    <div class="text-xs text-gray-500 mt-1 max-h-0 opacity-0 transition-all duration-300 group-hover:max-h-6 group-hover:opacity-100">
      Reach out to the development team for help or feedback.
    </div>
  </button>

  
</section>

<script>
// ⚡ Apply mode instantly (before render)
const cachedUser = JSON.parse(localStorage.getItem('user'));

if (cachedUser?.mode === 'gaming') {
  document.body.classList.add('gaming');
  document.getElementById('themeToggle').innerText = 'GAMING';
}


/* THEME TOGGLE */
const toggle = document.getElementById('themeToggle');
const clickSound = document.getElementById('clickSound');

document.querySelectorAll('button').forEach(b => {
  b.addEventListener('click', () => clickSound.play());
});

toggle.onclick = () => {
  document.body.classList.toggle('gaming');
  toggle.innerText = document.body.classList.contains('gaming')
    ? 'GAMING'
    : 'OFFICIAL';
};

/* SCROLL REVEAL */
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) e.target.classList.add('show');
  });
},{ threshold: .15 });

document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

/* BACKEND LOGIC – FETCH PROFILE */
async function fetchProfile() {
  const token = localStorage.getItem('token');
  if (!token) {
    window.location.href = 'login.html';
    return null;
  }
  try {
    const res = await fetch('https://attendace-zjzu.onrender.com/api/student/profile', {
      headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json'
      }
    });
    if (!res.ok) throw new Error('Failed to fetch profile');
    const data = await res.json();
    localStorage.setItem('user', JSON.stringify(data.user));
    return data.user;
  } catch (err) {
    console.error(err);
    alert('Could not fetch profile. Please login again.');
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    window.location.href = 'login.html';
    return null;
  }
}

/* INITIALIZE DASHBOARD */
document.addEventListener('DOMContentLoaded', async () => {
  const user = await fetchProfile();
  if (!user) return;

document.getElementById('studentName').textContent = user.name;
document.getElementById('studentId').textContent = "ID: " + user.id;
document.getElementById('studentDept').textContent = "Department: " + (user.department || "--");

// ✅ Set mode from DB
  if (user.mode === 'gaming') {
    document.body.classList.add('gaming');
    toggle.innerText = 'GAMING';
  } else {
    document.body.classList.remove('gaming');
    toggle.innerText = 'OFFICIAL';
  }



  // Logout
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    window.location.href = 'login.html';
  });
});
</script>

</body>
</html>